# æ•…éšœæ’é™¤æŒ‡å—

## ğŸ› å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

### 1. æ—¥å¿—è¾“å‡ºæ ¼å¼æ··ä¹±

**é—®é¢˜æè¿°ï¼š**
```
ğŸ“„ å“åº”å†…å®¹é¢„è§ˆ: {"content":"
<div class="container">
  <h1>Title</h1>
</div>
```

**åŸå› ï¼š**
JSON å†…å®¹ä¸­åŒ…å«æ¢è¡Œç¬¦ã€åˆ¶è¡¨ç¬¦ç­‰ç‰¹æ®Šå­—ç¬¦ï¼Œå¯¼è‡´æ§åˆ¶å°è¾“å‡ºæ ¼å¼æ··ä¹±ã€‚

**è§£å†³æ–¹æ¡ˆï¼š**
ä½¿ç”¨ `safeLogContent()` å‡½æ•°å¯¹æ—¥å¿—å†…å®¹è¿›è¡Œè½¬ä¹‰ï¼š

```typescript
function safeLogContent(content: any, maxLength = 100): string {
  try {
    return JSON.stringify(content)
      .replace(/\n/g, '\\n')    // è½¬ä¹‰æ¢è¡Œç¬¦
      .replace(/\r/g, '\\r')    // è½¬ä¹‰å›è½¦ç¬¦
      .replace(/\t/g, '\\t')    // è½¬ä¹‰åˆ¶è¡¨ç¬¦
      .substring(0, maxLength)
  } catch {
    return String(content).substring(0, maxLength)
  }
}
```

**ä¿®å¤åçš„è¾“å‡ºï¼š**
```
ğŸ“„ å“åº”å†…å®¹é¢„è§ˆ: {"content":"\\n<div class=\\"container\\">\\n  <h1>Title</h1>\\n</div>...
```

### 2. ç«¯å£å†²çªé”™è¯¯

**é—®é¢˜æè¿°ï¼š**
```
error: Failed to start server. Is port 3001 in use?
```

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥ç«¯å£å ç”¨ï¼š`lsof -i :3001`
2. ç»ˆæ­¢å ç”¨è¿›ç¨‹ï¼š`kill -9 <PID>`
3. æˆ–ä½¿ç”¨ä¸åŒç«¯å£ï¼š`PORT=3002 bun run test`

### 3. WebSocket è¿æ¥å¤±è´¥

**é—®é¢˜æè¿°ï¼š**
```
âŒ WebSocket connection failed
```

**å¯èƒ½åŸå› ï¼š**
- æœåŠ¡å™¨æœªå¯åŠ¨
- ç«¯å£é…ç½®é”™è¯¯
- é˜²ç«å¢™é˜»æ­¢è¿æ¥

**è§£å†³æ–¹æ¡ˆï¼š**
1. ç¡®è®¤æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ
2. æ£€æŸ¥ URL é…ç½®æ˜¯å¦æ­£ç¡®
3. éªŒè¯ç½‘ç»œè¿æ¥

### 4. æµ‹è¯•è¶…æ—¶

**é—®é¢˜æè¿°ï¼š**
```
âœ— this test timed out after 5000ms
```

**è§£å†³æ–¹æ¡ˆï¼š**
1. å¢åŠ è¶…æ—¶æ—¶é—´ï¼š`--timeout 10000`
2. æ£€æŸ¥ä¸šåŠ¡å¤„ç†å®¢æˆ·ç«¯æ˜¯å¦æ­£å¸¸è¿è¡Œ
3. éªŒè¯æ¶ˆæ¯æ˜¯å¦æ­£ç¡®å¹¿æ’­

### 5. ä¸šåŠ¡å¤„ç†å™¨æ— å“åº”

**é—®é¢˜æè¿°ï¼š**
MCP å®¢æˆ·ç«¯å‘é€è¯·æ±‚ä½†æ”¶ä¸åˆ°å“åº”ã€‚

**æ’æŸ¥æ­¥éª¤ï¼š**
1. æ£€æŸ¥ä¸šåŠ¡å¤„ç†å™¨æ˜¯å¦å·²è¿æ¥
2. æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—ç¡®è®¤æ¶ˆæ¯å¹¿æ’­
3. éªŒè¯æ¶ˆæ¯æ ¼å¼æ˜¯å¦æ­£ç¡®

**æ—¥å¿—ç¤ºä¾‹ï¼š**
```
ğŸ“¡ [æœåŠ¡å™¨] å¹¿æ’­æ¶ˆæ¯: MCPä¸šåŠ¡è¯·æ±‚ [client_123]
ğŸ“¡ [ä¸šåŠ¡å¤„ç†å™¨] æ”¶åˆ°MCPå®¢æˆ·ç«¯è¯·æ±‚: get_html_content [client_123]
âœ… [ä¸šåŠ¡å¤„ç†å™¨] å·²å¹¿æ’­å¤„ç†ç»“æœ: req_123456
```

## ğŸ”§ è°ƒè¯•æŠ€å·§

### 1. å¯ç”¨è¯¦ç»†æ—¥å¿—
æ‰€æœ‰ç»„ä»¶éƒ½åŒ…å«è¯¦ç»†çš„æ—¥å¿—è¾“å‡ºï¼Œå¯ä»¥é€šè¿‡æ—¥å¿—è·Ÿè¸ªæ¶ˆæ¯æµè½¬ï¼š

```
[MCPå®¢æˆ·ç«¯] -> [æœåŠ¡å™¨] -> [ä¸šåŠ¡å¤„ç†å™¨] -> [æœåŠ¡å™¨] -> [MCPå®¢æˆ·ç«¯]
```

### 2. æ£€æŸ¥è¿æ¥çŠ¶æ€
ä½¿ç”¨ `isConnected()` æ–¹æ³•æ£€æŸ¥ WebSocket è¿æ¥çŠ¶æ€ï¼š

```typescript
console.log('è¿æ¥çŠ¶æ€:', socketClient.isConnected())
```

### 3. æ‰‹åŠ¨æµ‹è¯•
åˆ†æ­¥éª¤æ‰‹åŠ¨å¯åŠ¨å„ä¸ªç»„ä»¶è¿›è¡Œæµ‹è¯•ï¼š

```bash
# ç»ˆç«¯ 1: å¯åŠ¨æœåŠ¡å™¨
bun run serve

# ç»ˆç«¯ 2: å¯åŠ¨ä¸šåŠ¡å¤„ç†å™¨
bun run business

# ç»ˆç«¯ 3: è¿è¡Œæµ‹è¯•
bun run test:unit
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. å‡å°‘æ—¥å¿—è¾“å‡º
åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¯ä»¥å‡å°‘è¯¦ç»†æ—¥å¿—ï¼š

```typescript
const isProduction = process.env.NODE_ENV === 'production'
if (!isProduction) {
  console.log('è°ƒè¯•ä¿¡æ¯...')
}
```

### 2. è¿æ¥å¤ç”¨
MCP å®¢æˆ·ç«¯ä¼šè‡ªåŠ¨å¤ç”¨ WebSocket è¿æ¥ï¼Œé¿å…é¢‘ç¹å»ºç«‹è¿æ¥ã€‚

### 3. è¶…æ—¶è®¾ç½®
æ ¹æ®ç½‘ç»œç¯å¢ƒè°ƒæ•´è¶…æ—¶æ—¶é—´ï¼š

```typescript
const socketClient = createSocketClient({
  url: 'ws://localhost:3001/ws',
  timeout: 15000  // 15ç§’è¶…æ—¶
})
```