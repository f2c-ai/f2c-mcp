# MCPå®¢æˆ·ç«¯å¹¿æ’­è¯·æ±‚å·¥ä½œæµç¨‹

## ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MCP å®¢æˆ·ç«¯    â”‚    â”‚  æ¶ˆæ¯ä¸­ç»§æœåŠ¡å™¨  â”‚    â”‚  ä¸šåŠ¡å¤„ç†å®¢æˆ·ç«¯  â”‚
â”‚  (è¯·æ±‚æ–¹)       â”‚    â”‚   (å¹¿æ’­ä¸­å¿ƒ)    â”‚    â”‚   (å¤„ç†æ–¹)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â”‚  1. æ³¨å†Œä¸ºMCPå®¢æˆ·ç«¯     â”‚                       â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚                       â”‚
         â”‚                       â”‚  2. æ³¨å†Œä¸ºä¸šåŠ¡å¤„ç†å™¨    â”‚
         â”‚                       â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚                       â”‚                       â”‚
         â”‚  3. å¹¿æ’­ä¸šåŠ¡è¯·æ±‚        â”‚                       â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚                       â”‚
         â”‚                       â”‚  4. è½¬å‘è¯·æ±‚åˆ°å¤„ç†å™¨    â”‚
         â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚
         â”‚                       â”‚                       â”‚
         â”‚                       â”‚  5. å¹¿æ’­å¤„ç†ç»“æœ        â”‚
         â”‚                       â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚  6. æ¥æ”¶å¤„ç†ç»“æœ        â”‚                       â”‚
         â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚
```

## æ¶ˆæ¯æµç¨‹è¯¦è§£

### 1. å®¢æˆ·ç«¯è¿æ¥å’Œæ³¨å†Œ

#### MCPå®¢æˆ·ç«¯æ³¨å†Œ
```typescript
// è¿æ¥å»ºç«‹åè‡ªåŠ¨å‘é€
{
  type: 'register_client',
  clientType: 'mcp_client',
  capabilities: ['request_html_generation'],
  timestamp: Date.now()
}
```

#### ä¸šåŠ¡å¤„ç†å®¢æˆ·ç«¯æ³¨å†Œ
```typescript
{
  type: 'register_client',
  clientType: 'business_processor',
  processorType: 'html_generator',
  capabilities: ['get_html_content'],
  timestamp: Date.now()
}
```

### 2. ä¸šåŠ¡è¯·æ±‚å¹¿æ’­

#### MCPå®¢æˆ·ç«¯å‘èµ·è¯·æ±‚
```typescript
// åŸå§‹è°ƒç”¨
socketClient.request('get_html_content', {
  componentName: 'Button',
  framework: 'react',
  style: 'tailwind'
})

// å®é™…å‘é€çš„å¹¿æ’­æ¶ˆæ¯
{
  type: 'business_request',
  originalType: 'get_html_content',
  originalRequestId: 'req_123456',
  data: {
    componentName: 'Button',
    framework: 'react',
    style: 'tailwind'
  },
  clientId: 'client_mcp_001',
  clientType: 'mcp_client',
  timestamp: Date.now()
  // æ— targetå­—æ®µ = å¹¿æ’­æ¶ˆæ¯
}
```

### 3. ä¸šåŠ¡å¤„ç†å’Œå“åº”

#### ä¸šåŠ¡å¤„ç†å®¢æˆ·ç«¯æ¥æ”¶å¹¿æ’­
```typescript
// æ”¶åˆ°çš„æ¶ˆæ¯ (æœåŠ¡å™¨æ·»åŠ äº†å¹¿æ’­æ ‡è¯†)
{
  type: 'business_request',
  originalType: 'get_html_content',
  originalRequestId: 'req_123456',
  data: { ... },
  clientId: 'client_mcp_001',
  clientType: 'mcp_client',
  sender: 'client_mcp_001',
  broadcast: true,
  broadcastAt: Date.now(),
  timestamp: Date.now()
}
```

#### ä¸šåŠ¡å¤„ç†å®¢æˆ·ç«¯å“åº”
```typescript
// å¤„ç†å®Œæˆåå¹¿æ’­ç»“æœ
{
  type: 'business_response',
  originalRequestId: 'req_123456',
  originalType: 'get_html_content',
  success: true,
  data: {
    content: '<div class="container">...</div>'
  },
  processorId: 'client_processor_001',
  timestamp: Date.now()
  // æ— targetå­—æ®µ = å¹¿æ’­å“åº”
}
```

### 4. ç»“æœæ¥æ”¶

#### MCPå®¢æˆ·ç«¯æ¥æ”¶å“åº”
```typescript
// æ”¶åˆ°çš„å¹¿æ’­å“åº”
{
  type: 'business_response',
  originalRequestId: 'req_123456',
  originalType: 'get_html_content',
  success: true,
  data: { content: '...' },
  processorId: 'client_processor_001',
  sender: 'client_processor_001',
  broadcast: true,
  broadcastAt: Date.now(),
  timestamp: Date.now()
}
```

## å¯åŠ¨å’Œæµ‹è¯•

### 1. å¯åŠ¨æ¶ˆæ¯ä¸­ç»§æœåŠ¡å™¨
```bash
bun run serve
```

### 2. å¯åŠ¨ä¸šåŠ¡å¤„ç†å®¢æˆ·ç«¯
```bash
bun run business
```

### 3. è¿è¡ŒMCPå®¢æˆ·ç«¯æµ‹è¯•
```bash
HONO_WS_URL=ws://localhost:3001/ws bun test
```

## æ—¥å¿—è¾“å‡ºç¤ºä¾‹

### æœåŠ¡å™¨æ—¥å¿—
```
ğŸš€ MCP Server (Hono+Bun) listening on http://localhost:3001/mcp
ğŸ”Œ WebSocket Message Relay Server listening on ws://localhost:3001/ws
ğŸ“¡ æœåŠ¡æ¨¡å¼: æ¶ˆæ¯ä¸­ç»§å’Œå¹¿æ’­ (ä¸å¤„ç†ä¸šåŠ¡é€»è¾‘)
ğŸ“‹ æ”¯æŒåŠŸèƒ½: ç‚¹å¯¹ç‚¹è½¬å‘ã€å¹¿æ’­ã€è¿æ¥ç®¡ç†

ğŸ”Œ å®¢æˆ·ç«¯è¿æ¥: client_1234567890_abc123 (æ€»è¿æ¥æ•°: 1)
ğŸ“‹ å®¢æˆ·ç«¯æ³¨å†Œ: client_1234567890_abc123 (business_processor)
ğŸ“Š å½“å‰çŠ¶æ€: MCPå®¢æˆ·ç«¯ 0 ä¸ª, ä¸šåŠ¡å¤„ç†å™¨ 1 ä¸ª

ğŸ”Œ å®¢æˆ·ç«¯è¿æ¥: client_1234567891_def456 (æ€»è¿æ¥æ•°: 2)
ğŸ“‹ å®¢æˆ·ç«¯æ³¨å†Œ: client_1234567891_def456 (mcp_client)
ğŸ“Š å½“å‰çŠ¶æ€: MCPå®¢æˆ·ç«¯ 1 ä¸ª, ä¸šåŠ¡å¤„ç†å™¨ 1 ä¸ª

ğŸ“¨ æ”¶åˆ°æ¶ˆæ¯ [client_1234567891_def456]: business_request
ğŸ“¡ æ¶ˆæ¯å¹¿æ’­: client_1234567891_def456 -> 1 ä¸ªå®¢æˆ·ç«¯

ğŸ“¨ æ”¶åˆ°æ¶ˆæ¯ [client_1234567890_abc123]: business_response
ğŸ“¡ æ¶ˆæ¯å¹¿æ’­: client_1234567890_abc123 -> 1 ä¸ªå®¢æˆ·ç«¯
```

### MCPå®¢æˆ·ç«¯æ—¥å¿—
```
ğŸ”Œ MCPå®¢æˆ·ç«¯å·²è¿æ¥åˆ°æ¶ˆæ¯ä¸­ç»§æœåŠ¡å™¨
âœ… MCPå®¢æˆ·ç«¯å·²è·å¾—ID: client_1234567891_def456
ğŸ“¢ å·²æ³¨å†Œä¸ºMCPå®¢æˆ·ç«¯
Socket è¿æ¥çŠ¶æ€: true
ğŸ“¡ å¹¿æ’­ä¸šåŠ¡è¯·æ±‚: get_html_content (req_123456)
ğŸ“¡ æ”¶åˆ°å¹¿æ’­å“åº” [client_1234567890_abc123]: req_123456
```

### ä¸šåŠ¡å¤„ç†å®¢æˆ·ç«¯æ—¥å¿—
```
ğŸ”Œ ä¸šåŠ¡å¤„ç†å®¢æˆ·ç«¯å·²è¿æ¥åˆ°æ¶ˆæ¯ä¸­ç»§æœåŠ¡å™¨
âœ… ä¸šåŠ¡å¤„ç†å®¢æˆ·ç«¯å·²è·å¾—ID: client_1234567890_abc123
ğŸ“¢ å·²æ³¨å†Œä¸º HTML ç”Ÿæˆå¤„ç†å™¨
ğŸ“¡ æ”¶åˆ°å¹¿æ’­ä¸šåŠ¡è¯·æ±‚: get_html_content [client_1234567891_def456]
ğŸ”¨ å¤„ç† HTML ç”Ÿæˆè¯·æ±‚: Button
âœ… å·²å¹¿æ’­å¤„ç†ç»“æœ: req_123456
```

## ä¼˜åŠ¿ç‰¹ç‚¹

1. **å®Œå…¨è§£è€¦**: MCPå®¢æˆ·ç«¯ä¸éœ€è¦çŸ¥é“ä¸šåŠ¡å¤„ç†å™¨çš„å­˜åœ¨
2. **åŠ¨æ€æ‰©å±•**: å¯ä»¥éšæ—¶æ·»åŠ æ–°çš„ä¸šåŠ¡å¤„ç†å™¨
3. **å®¹é”™æ€§**: æŸä¸ªå¤„ç†å™¨ç¦»çº¿ä¸å½±å“å…¶ä»–åŠŸèƒ½
4. **è´Ÿè½½åˆ†æ‹…**: å¤šä¸ªå¤„ç†å™¨å¯ä»¥åŒæ—¶å¤„ç†ä¸åŒè¯·æ±‚
5. **å®æ—¶æ€§**: åŸºäºWebSocketçš„å®æ—¶é€šä¿¡