# 自动化测试指南

## 🚀 一键测试

运行完整的自动化测试（包括服务器启动、业务处理客户端和所有测试用例）：

```bash
bun run test
```

这个命令会：
1. 自动启动 MCP + WebSocket 服务器
2. 启动业务处理客户端
3. 运行所有集成测试
4. 自动清理进程

## 📋 测试覆盖

### 1. MCP 服务器健康检查
- ✅ 服务器连接
- ✅ 工具列表
- ✅ 工具模式验证

### 2. WebSocket 连接测试
- ✅ Socket 连接
- ✅ 请求-响应流程
- ✅ 超时处理

### 3. MCP 工具输入输出测试
- ✅ React + Tailwind
- ✅ React + CSS
- ✅ Vue + Tailwind
- ✅ Vue + CSS
- ✅ 默认参数处理
- ✅ 空组件名处理

### 4. 参数验证测试
- ✅ 无效框架拒绝
- ✅ 无效样式拒绝

### 5. 性能和可靠性测试
- ✅ 响应时间测试
- ✅ 并发请求处理
- ✅ 顺序请求处理

### 6. 错误处理测试
- ✅ Socket 连接错误处理
- ✅ 错误消息质量

### 7. 端到端集成测试
- ✅ 完整工作流程
- ✅ 多场景测试

## 🔧 手动测试

如果需要手动控制测试流程：

```bash
# 1. 启动服务器
bun run serve

# 2. 启动业务处理客户端（新终端）
bun run business

# 3. 运行测试（新终端）
bun run test:unit
```

## 📊 测试结果

测试会显示详细的执行日志，包括：
- 连接状态
- 请求响应时间
- 成功/失败统计
- 错误详情

成功的测试运行应该显示：
```
🎉 所有测试通过！
```

## 🐛 故障排除

如果测试失败：

1. **端口冲突**: 确保端口 3001 未被占用
2. **依赖问题**: 运行 `bun install` 重新安装依赖
3. **进程残留**: 手动终止可能残留的进程

## 🏗️ 架构说明

测试系统基于：
- **Elysia**: WebSocket 服务器框架
- **MCP SDK**: Model Context Protocol 实现
- **Bun**: 运行时和测试框架
- **广播机制**: 客户端间消息中继